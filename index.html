<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Evaluativo de Matemáticas</title>
    
    <!-- KaTeX -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/auto-render.min.js"></script>

    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f2f5;
            color: #333;
        }

        h1, h2 {
            text-align: center;
            color: #1a237e;
        }

        #categories-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px auto;
            max-width: 1200px;
            padding: 20px;
        }

        .category-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .category-card:hover {
            transform: translateY(-5px);
        }

        .select-btn {
            background: #2196f3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            transition: background 0.3s ease;
        }

        .select-btn:hover {
            background: #1976d2;
        }

        .select-btn.selected {
            background: #4caf50;
        }

        #start-button {
            display: block;
            margin: 20px auto;
            padding: 15px 30px;
            background: #4caf50;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        #start-button:hover {
            background: #388e3c;
        }

        .exam-section {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .question-container {
            margin: 20px 0;
        }

        .option-label {
            display: block;
            padding: 15px;
            margin: 10px 0;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .option-label:hover {
            border-color: #2196f3;
            background: #f5f5f5;
        }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        .nav-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        #prev-btn {
            background: #9e9e9e;
            color: white;
        }

        #next-btn, #finish-btn {
            background: #2196f3;
            color: white;
        }

        .hidden {
            display: none;
        }

        #results-section {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .result-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .score {
            font-size: 24px;
            font-weight: bold;
            color: #2196f3;
            text-align: center;
            margin: 20px 0;
        }

        .question-result {
            margin: 15px 0;
            padding: 15px;
            border-radius: 5px;
        }

        .question-result.correct {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
        }

        .question-result.incorrect {
            background: #ffebee;
            border-left: 4px solid #f44336;
        }

        .restart-btn {
            display: block;
            width: 200px;
            margin: 20px auto;
            padding: 12px 24px;
            background: #4caf50;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .restart-btn:hover {
            background: #388e3c;
        }
    </style>
</head>
<body>
    <div id="setup-section">
        <h1>Sistema de entrenamiento para el área de matemática</h1>
        <div id="categories-container"></div>
        <button id="start-button">Comenzar Evaluación</button>
    </div>

    <div id="exam-section" class="exam-section hidden">
        <h2>Evaluación en Curso</h2>
        <div id="question-container"></div>
        <div class="nav-buttons">
            <button id="prev-btn" class="nav-btn hidden">Anterior</button>
            <button id="next-btn" class="nav-btn">Siguiente</button>
            <button id="finish-btn" class="nav-btn hidden">Finalizar</button>
        </div>
    </div>

    <div id="results-section" class="hidden">
        <h2>Resultados de la Evaluación</h2>
        <div class="result-card">
            <h3>Puntuación Final</h3>
            <div id="score-display" class="score"></div>
            <div id="detailed-results"></div>
        </div>
        <button class="restart-btn" onclick="examSystem.resetExam()">Nueva Evaluación</button>
    </div>

    <script>
        class ExamSystem {
            constructor() {
                this.categories = {
                    aritmetica: {
                        name: 'Aritmética',
                        description: 'Operaciones con números y fracciones',
                        questions: [
                            {
                                question: 'Resuelve la siguiente operación',
                                latex: '\\frac{2}{3} + \\frac{5}{6}',
                                options: [
                                    { latex: '\\frac{3}{2}' },
                                    { latex: '\\frac{7}{6}' },
                                    { latex: '\\frac{19}{18}' },
                                    { latex: '\\frac{25}{18}' }
                                ],
                                correct: 1
                            },
                            {
                                question: 'Calcula',
                                latex: '\\sqrt{144} + \\sqrt{36}',
                                options: [
                                    { latex: '18' },
                                    { latex: '12' },
                                    { latex: '24' },
                                    { latex: '6' }
                                ],
                                correct: 0
                            }
                        ]
                    },
                    geometria: {
                        name: 'Geometría',
                        description: 'Formas, áreas y perímetros',
                        questions: [
                            {
                                question: 'Calcula el área de un círculo con radio',
                                latex: 'r = 5\\text{ cm}',
                                options: [
                                    { latex: '25\\pi\\text{ cm}^2' },
                                    { latex: '10\\pi\\text{ cm}^2' },
                                    { latex: '15\\pi\\text{ cm}^2' },
                                    { latex: '20\\pi\\text{ cm}^2' }
                                ],
                                correct: 0
                            }
                        ]
                    },
                    Razonamientologico1: {
                        name: 'Razonamiento lógico',
                        description: 'Razonamiento lógico y comprension lectora',
                        questions: [
                            {
                                    question: "En una fiesta, cuatro hombres tienen diferentes profesiones: fotógrafo, tendero, banquero y cantante. Si el señor Blanco sondea al banquero sobre un préstamo, ¿qué profesión NO puede tener el señor Blanco?",
                                    latex: '',
                                    options: [
                                            { latex: '\\text{Banquero}' },
                                            { latex: '\\text{Tendero}' },
                                            { latex: '\\text{Fotógrafo}' },
                                            { latex: '\\text{Cantante}' }
                                ],
                                correct: 0
                            },
                            {
                                question: "Sabiendo que el señor Castaño conoció al fotógrafo cuando lo contrató para su boda, y que el cantante y el señor Blanco son amigos, ¿quién es definitivamente el cantante?",
                                latex: '',
                                options: [
                                        { latex:"\\text{El señor Castaño}"},
                                        { latex:"\\text{El señor Blanco}"},
                                        { latex:"\\text{El señor Rubio}"},
                                        { latex:"\\text{El señor Moreno}"}
                                ],
                                correct: 0
                              },
                              {
                                question: "Si ni el señor Moreno ni el cantante conocían al señor Rubio antes de la fiesta, y sabemos que el señor Castaño es el cantante, ¿qué profesión debe tener el señor Rubio?",
                                latex: '',
                                options: [
                                  { latex:"\\text{Banquero}"},
                                  { latex:"\\text{Fotógrafo}"},
                                  { latex:"\\text{Tendero}"},
                                  { latex:"\\text{Cantante}"}
                                ],
                                correct: 0
                              },
                              {
                                question: "¿Qué se puede deducir del hecho de que el señor Blanco sondee al banquero sobre un préstamo?",
                                latex: '',
                                options: [
                                  { latex:"\\text{El señor Blanco es el tendero}"},
                                  { latex:"\\text{El señor Blanco es el fotógrafo}"},
                                  { latex:"\\text{El señor Blanco es el cantante}"},
                                  { latex:"\\text{El señor Blanco es el banquero}"}
                                ],
                                correct: 0
                              },
                              {
                                question: "¿Por qué proceso lógico se determina que el señor Moreno es el fotógrafo?",
                                latex: '',
                                options: [
                                  { latex:"\\text{Por eliminación, ya que los demás roles están asignados}"},
                                  { latex:"\\text{Porque conocía al señor Rubio}"},
                                  { latex:"\\text{Porque trabajó en la boda de Castaño}"},
                                  { latex:"\\text{Porque no es el cantante}"}
                                ],
                                correct: 0
                              },
                              {
                                question: "Si el señor Blanco y el cantante son amigos pero nunca han tenido tratos de negocios, ¿qué se puede deducir?",
                                latex: '',
                                options: [
                                  { latex:"\\text{El señor Blanco no es el cantante}"},
                                  { latex:"\\text{El señor Blanco es el cantante}"},
                                  { latex:"\\text{El señor Blanco es el banquero}"},
                                  { latex:"\\text{El señor Blanco es el fotógrafo}"}
                                ],
                                correct: 0
                              },
                              {
                                question: "¿Qué profesión debe tener el señor Blanco según todas las pistas disponibles?",
                                latex: '',
                                options: [
                                  { latex:"\\text{Tendero}"},
                                  { latex:"\\text{Banquero}"},
                                  { latex:"\\text{Fotógrafo}"},
                                  { latex:"\\text{Cantante}"}
                                ],
                                correct: 0
                              },
                              {
                                question: "¿Cuál es la razón principal por la que el señor Castaño no puede ser el fotógrafo?",
                                latex: '',
                                options: [
                                  { latex:"\\text{Porque contrató al fotógrafo para su boda}"},
                                  { latex:"\\text{Porque es el cantante}"},
                                  { latex:"\\text{Porque conoce al señor Blanco}"},
                                  { latex:"\\text{Porque no conocía al señor Rubio}"}
                                ],
                                correct: 0
                              },
                              {
                                question: "¿Qué información clave permite descartar al señor Rubio como cantante?",
                                latex: '',
                                options: [
                                  { latex:"\\text{Que nadie lo conocía antes de la fiesta}"},
                                  { latex:"\\text{Que es el banquero}"},
                                  { latex:"\\text{Que conoce al señor Blanco}"},
                                  { latex:"\\text{Que es amigo del fotógrafo}"}
                                ],
                                correct: 0
                              },
                              {
                                question: "¿Cuál es la secuencia lógica correcta para resolver el problema?",
                                latex: '',
                                options: [
                                  { latex:"\\text{Identificar al cantante, luego al tendero, al banquero y finalmente al fotógrafo}"},
                                  { latex:"\\text{Identificar al banquero, luego al fotógrafo, al tendero y finalmente al cantante}"},
                                  { latex:"\\text{Identificar al fotógrafo, luego al cantante, al tendero y finalmente al banquero}"},
                                  { latex:"\\text{Identificar al tendero, luego al cantante, al fotógrafo y finalmente al banquero}"}
                                ],
                                correct: 0
                              },
                              {
                                question: "En una habitación hay cinco personas (Ana, Benito, Carlos, Diana y Eduardo) y cada uno bebe una bebida diferente (café, té, jugo de naranja, jugo de piña y agua). Si Ana no bebe café ni té, ¿qué profesión tiene Ana según las pistas?",
                                latex: '',
                                options: [
                                  { latex:"\\text{Abogada}"},
                                  { latex:"\\text{Ingeniera}"},
                                  { latex:"\\text{Profesora}"},
                                  { latex:"\\text{Doctora}"}
                                ],
                                correct: 0
                              },
                              {
                                question: "Si el doctor bebe algo que no es agua y Diana bebe agua, ¿qué profesión debe tener Eduardo?",
                                latex: '',
                                options: [
                                  { latex:"\\text{Profesor}"},
                                  { latex:"\\text{Doctor}"},
                                  { latex:"\\text{Ingeniero}"},
                                  { latex:"\\text{Abogado}"}
                                ],
                                correct: 0
                              },
                              {
                                question: "Sabiendo que Benito es el ingeniero y Ana es la abogada, ¿qué bebida debe tomar Benito?",
                                latex: '',
                                options: [
                                  { latex:"\\text{Jugo de piña}"},
                                  { latex:"\\text{Café}"},
                                  { latex:"\\text{Té}"},
                                  { latex:"\\text{Agua}"}
                                ],
                                correct: 0
                              },
                              {
                                question: "¿Qué bebida toma Carlos según la deducción lógica de las pistas?",
                                latex: '',
                                options: [
                                  { latex:"\\text{Té}"},
                                  { latex:"\\text{Café}"},
                                  { latex:"\\text{Jugo de naranja}"},
                                  { latex:"\\text{Agua}"}
                                ],
                                correct: 0
                              },
                              {
                                question: "Si Ana toma jugo de naranja y Benito toma jugo de piña, ¿qué se puede deducir sobre la bebida de Diana?",
                                latex: '',
                                options: [
                                  { latex:"\\text{Debe tomar agua}"},
                                  { latex:"\\text{Debe tomar té}"},
                                  { latex:"\\text{Debe tomar café}"},
                                  { latex:"\\text{No se puede determinar}"}
                                ],
                                correct: 0
                              },
                              {
                                question: "¿Cuál es la secuencia correcta de deducciones para resolver este problema?",
                                latex: '',
                                options: [
                                  { latex:"\\text{Bebida de Ana → Profesión de Ana → Bebida de Benito → Bebida de Carlos → Bebida de Diana}"},
                                  { latex:"\\text{Profesión de Ana → Bebida de Ana → Bebida de Carlos → Bebida de Diana → Bebida de Benito}"},
                                  { latex:"\\text{Bebida de Diana → Bebida de Ana → Bebida de Carlos → Bebida de Benito → Profesiones}"},
                                  { latex:"\\text{Profesiones → Bebidas → Combinaciones → Conclusiones}"}
                                ],
                                correct: 0
                              },
                              {
                                question: "¿Por qué podemos deducir que Eduardo es el profesor?",
                                latex: '',
                                options: [
                                  { latex:"\\text{Porque la persona que bebe agua no es el profesor y Diana bebe agua}"},
                                  { latex:"\\text{Porque es el último sin profesión asignada}"},
                                  { latex:"\\text{Porque no bebe café}"},
                                  { latex:"\\text{Porque no es ingeniero}"}
                                ],
                                correct: 0
                              },
                              {
                                question: "Si Ana es abogada y toma jugo de naranja, ¿qué profesión NO puede tener Benito?",
                                latex: '',
                                options: [
                                  { latex:"\\text{Abogado}"},
                                  { latex:"\\text{Profesor}"},
                                  { latex:"\\text{Doctor}"},
                                  { latex:"\\text{Todos podrían ser}"}
                                ],
                                correct: 0
                              },
                              {
                                question: "¿Qué combinación es INCORRECTA según las pistas dadas?",
                                latex: '',
                                options: [
                                  { latex:"\\text{Diana - Doctora - Té}"},
                                  { latex:"\\text{Ana - Abogada - Jugo de naranja}"},
                                  { latex:"\\text{Benito - Ingeniero - Jugo de piña}"},
                                  { latex:"\\text{Eduardo - Profesor - Café}"}
                                ],
                                correct: 0
                              },
                              {
                                question: "¿Cuál es la conclusión final correcta para todas las personas y sus bebidas?",
                                latex: '',
                                options: [
                                  { latex:"\\text{Ana-Jugo de naranja, Benito-Jugo de piña, Carlos-Té, Diana-Agua, Eduardo-Café}"},
                                  { latex:"\\text{Ana-Té, Benito-Jugo de naranja, Carlos-Agua, Diana-Café, Eduardo-Jugo de piña}"},
                                  { latex:"\\text{Ana-Jugo de piña, Benito-Té, Carlos-Jugo de naranja, Diana-Agua, Eduardo-Café}"},
                                  { latex:"\\text{Ana-Agua, Benito-Café, Carlos-Té, Diana-Jugo de naranja, Eduardo-Jugo de piña}"}
                                ],
                                correct: 0
                              },
                              {
                                question: "En una fiesta nocturna, si el programador está más cerca de la puerta y el músico se queda atrás, ¿quién debe estar en la segunda posición desde la puerta?",
                                options: [
                                  { latex:"\\text{El escritor}"},
                                  { latex:"\\text{El chef}"},
                                  { latex:"\\text{El músico}"},
                                  { latex:"\\text{El programador}"}
                                ],
                                correct: 0
                              },
                              {
                                question: "Si el chef es el que menos cerca está de la puerta y el escritor está en el medio, ¿en qué orden están ubicadas las personas desde la puerta hacia adentro?",
                                options: [
                                  { latex:"\\text{Programador, escritor, chef, músico}"},
                                  { latex:"\\text{Programador, chef, escritor, músico}"},
                                  { latex:"\\text{Escritor, programador, chef, músico}"},
                                  { latex:"\\text{Chef, programador, escritor, músico}"}
                                ],
                                correct: 0
                              },
                              {
                                question: "¿Qué información nos permite determinar definitivamente la posición del escritor?",
                                options: [
                                  { latex:"\\text{Que está en el medio entre el programador y el chef}"},
                                  { latex:"\\text{Que no es el último}"},
                                  { latex:"\\text{Que no es el primero}"},
                                  { latex:"\\text{Que está después del chef}"}
                                ],
                                correct: 0
                              },
                              {
                                question: "¿Por qué el chef no puede estar en la segunda posición?",
                                options: [
                                  { latex:"\\text{Porque debe estar más lejos de la puerta que el escritor}"},
                                  { latex:"\\text{Porque es el músico}"},
                                  { latex:"\\text{Porque está primero}"},
                                  { latex:"\\text{Porque está junto al programador}"}
                                ],
                                correct: 0
                              },
                              {
                                question: "¿Qué podemos deducir sobre la posición del músico?",
                                options: [
                                  { latex:"\\text{Está en la última posición}"},
                                  { latex:"\\text{Está junto al chef}"},
                                  { latex:"\\text{Está cerca de la puerta}"},
                                  { latex:"\\text{Está en el medio}"}
                                ],
                                correct: 0
                              },
                              {
                                question: "¿Cuál es la secuencia lógica correcta para resolver este problema?",
                                options: [
                                  { latex:"\\text{Ubicar al programador, luego al escritor, después al chef y finalmente al músico}"},
                                  { latex:"\\text{Ubicar al músico, luego al chef, después al escritor y finalmente al programador}"},
                                  { latex:"\\text{Ubicar al chef, luego al músico, después al programador y finalmente al escritor}"},
                                  { latex:"\\text{Ubicar al escritor, luego al programador, después al músico y finalmente al chef}"}
                                ],
                                correct: 0
                              },
                              {
                                question: "¿Qué pista es INNECESARIA para resolver el problema?",
                                options: [
                                  { latex:"\\text{Que es en un club nocturno}"},
                                  { latex:"\\text{Que el chef está más lejos de la puerta}"},
                                  { latex:"\\text{Que el escritor está en el medio}"},
                                  { latex:"\\text{Que el programador está más cerca de la puerta}"}
                                ],
                                correct: 0
                              },
                              {
                                question: "Si sabemos que el programador está primero y el músico último, ¿qué otra información necesitamos para resolver el problema?",
                                options: [
                                  { latex:"\\text{La posición del escritor en el medio}"},
                                  { latex:"\\text{La profesión de la última persona}"},
                                  { latex:"\\text{El orden de llegada a la fiesta}"},
                                  { latex:"\\text{La distancia entre cada persona}"}
                                ],
                                correct: 0
                              },
                              {
                                question: "¿Cuál de las siguientes afirmaciones es INCORRECTA según las pistas dadas?",
                                options: [
                                  { latex:"\\text{El chef está junto al músico}"},
                                  { latex:"\\text{El programador está más cerca de la puerta}"},
                                  { latex:"\\text{El escritor está en medio}"},
                                  { latex:"\\text{El músico está al final}"}
                                ],
                                correct: 0
                              },
                              {
                                question: "¿Qué característica hace único este problema de posicionamiento?",
                                options: [
                                  { latex:"\\text{Combina posiciones relativas con posiciones absolutas}"},
                                  { latex:"\\text{Solo usa posiciones relativas}"},
                                  { latex:"\\text{Solo usa posiciones absolutas}"},
                                  { latex:"\\text{No especifica las distancias exactas}"}
                                ],
                                correct: 0
                              }
                        ]
                    },
                    algebra: {
                        name: 'Álgebra',
                        description: 'Ecuaciones y expresiones algebraicas',
                        questions: [
                            {
                                question: 'Resuelve la ecuación',
                                latex: '2x + 5 = 13',
                                options: [
                                    { latex: 'x = 3' },
                                    { latex: 'x = 4' },
                                    { latex: 'x = 5' },
                                    { latex: 'x = 6' }
                                ],
                                correct: 1
                            }
                        ]
                    },
                    reglaDeTres: {
                        name: 'Regla de Tres',
                        description: 'Problemas de proporcionalidad',
                        questions: [
                            {
                                question: 'Si 3 obreros tardan 12 días, ¿cuánto tardarán 6 obreros?',
                                latex: '\\frac{3}{6} = \\frac{x}{12}',
                                options: [
                                    { latex: '24\\text{ días}' },
                                    { latex: '6\\text{ días}' },
                                    { latex: '4\\text{ días}' },
                                    { latex: '8\\text{ días}' }
                                ],
                                correct: 1
                            }
                        ]
                    }
                };
                
                this.selectedCategories = new Set();
                this.currentQuestions = [];
                this.currentIndex = 0;
                this.answers = {};
                this.results = {
                    correctAnswers: 0,
                    totalQuestions: 0,
                    details: []
                };
                
                this.initializeUI();
            }
        
            initializeUI() {
                this.renderCategories();
                this.bindEvents();
            }
        
            renderCategories() {
                const container = document.getElementById('categories-container');
                Object.entries(this.categories).forEach(([id, category]) => {
                    const card = document.createElement('div');
                    card.className = 'category-card';
                    card.innerHTML = `
                        <h3>${category.name}</h3>
                        <p>${category.description}</p>
                        <button class="select-btn" data-id="${id}">Seleccionar</button>
                    `;
                    container.appendChild(card);
                });
            }
        
            bindEvents() {
                document.querySelectorAll('.select-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const categoryId = e.target.dataset.id;
                        this.toggleCategory(categoryId, e.target);
                    });
                });
        
                document.getElementById('start-button').addEventListener('click', () => this.startExam());
                document.getElementById('next-btn').addEventListener('click', () => this.nextQuestion());
                document.getElementById('prev-btn').addEventListener('click', () => this.previousQuestion());
                document.getElementById('finish-btn').addEventListener('click', () => this.finishExam());
            }
        
            toggleCategory(categoryId, button) {
                if (this.selectedCategories.has(categoryId)) {
                    this.selectedCategories.delete(categoryId);
                    button.classList.remove('selected');
                    button.textContent = 'Seleccionar';
                } else {
                    this.selectedCategories.add(categoryId);
                    button.classList.add('selected');
                    button.textContent = 'Seleccionado';
                }
            }
        
            startExam() {
                if (this.selectedCategories.size === 0) {
                    alert('Por favor, selecciona al menos una categoría');
                    return;
                }
        
                this.currentQuestions = [];
                this.selectedCategories.forEach(categoryId => {
                    this.categories[categoryId].questions.forEach(question => {
                        this.currentQuestions.push({...question, category: categoryId});
                    });
                });
        
                document.getElementById('setup-section').classList.add('hidden');
                document.getElementById('exam-section').classList.remove('hidden');
                document.getElementById('results-section').classList.add('hidden');
                
                this.currentIndex = 0;
                this.displayCurrentQuestion();
            }
        
            displayCurrentQuestion() {
                const question = this.currentQuestions[this.currentIndex];
                const container = document.getElementById('question-container');
        
                container.innerHTML = `
                    <div class="question">
                        <h3>${question.question}</h3>
                        <div class="latex-display">$${question.latex}$</div>
                        <div class="options">
                            ${question.options.map((option, index) => `
                                <label class="option-label">
                                    <input type="radio" name="answer" value="${index}"
                                        ${this.answers[this.currentIndex] === index ? 'checked' : ''}>
                                    <span>$${option.latex}$</span>
                                </label>
                            `).join('')}
                        </div>
                    </div>
                `;
        
                renderMathInElement(container, {
                    delimiters: [
                        {left: "\\[", right: "\\]", display: true},
                        {left: "$", right: "$", display: false}
                    ],
                    throwOnError: false
                });
        
                this.updateNavigation();
            }
        
            updateNavigation() {
                document.getElementById('prev-btn').classList.toggle('hidden', this.currentIndex === 0);
                document.getElementById('next-btn').classList.toggle('hidden', this.currentIndex === this.currentQuestions.length - 1);
                document.getElementById('finish-btn').classList.toggle('hidden', this.currentIndex !== this.currentQuestions.length - 1);
            }
        
            nextQuestion() {
                const selectedAnswer = document.querySelector('input[name="answer"]:checked');
                if (!selectedAnswer) {
                    alert('Por favor, selecciona una respuesta antes de continuar');
                    return;
                }
        
                this.answers[this.currentIndex] = parseInt(selectedAnswer.value);
        
                if (this.currentIndex < this.currentQuestions.length - 1) {
                    this.currentIndex++;
                    this.displayCurrentQuestion();
                }
            }
        
            previousQuestion() {
                if (this.currentIndex > 0) {
                    this.currentIndex--;
                    this.displayCurrentQuestion();
                }
            }
        
            finishExam() {
                
        const selectedAnswer = document.querySelector('input[name="answer"]:checked');
        if (!selectedAnswer) {
            alert('Por favor, selecciona una respuesta antes de finalizar');
            return;
        }

        this.answers[this.currentIndex] = parseInt(selectedAnswer.value);
        this.calculateResults();
        this.showResults();
    }

    calculateResults() {
        this.results.correctAnswers = 0;
        this.results.details = [];
        this.results.totalQuestions = this.currentQuestions.length;

        this.currentQuestions.forEach((question, index) => {
            const isCorrect = this.answers[index] === question.correct;
            if (isCorrect) {
                this.results.correctAnswers++;
            }

            this.results.details.push({
                question: question.question,
                latex: question.latex,
                userAnswer: question.options[this.answers[index]].latex,
                correctAnswer: question.options[question.correct].latex,
                isCorrect: isCorrect,
                category: question.category
            });
        });
    }

    showResults() {
        document.getElementById('exam-section').classList.add('hidden');
        document.getElementById('results-section').classList.remove('hidden');

        const score = (this.results.correctAnswers / this.results.totalQuestions) * 100;
        document.getElementById('score-display').textContent = 
            `${this.results.correctAnswers} de ${this.results.totalQuestions} correctas (${score.toFixed(2)}%)`;

        const detailedResults = document.getElementById('detailed-results');
        detailedResults.innerHTML = this.results.details.map((result, index) => `
            <div class="question-result ${result.isCorrect ? 'correct' : 'incorrect'}">
                <p><strong>Pregunta ${index + 1}</strong> (${this.categories[result.category].name})</p>
                <p>${result.question}</p>
                <p>$${result.latex}$</p>
                <p>Tu respuesta: $${result.userAnswer}$</p>
                ${!result.isCorrect ? `<p>Respuesta correcta: $${result.correctAnswer}$</p>` : ''}
            </div>
        `).join('');

        renderMathInElement(detailedResults, {
            delimiters: [
                {left: "\\[", right: "\\]", display: true},
                {left: "$", right: "$", display: false}
            ],
            throwOnError: false
        });
    }

    resetExam() {
        // Reiniciar el estado del sistema
        this.selectedCategories.clear();
        this.currentQuestions = [];
        this.currentIndex = 0;
        this.answers = {};
        this.results = {
            correctAnswers: 0,
            totalQuestions: 0,
            details: []
        };

        // Reiniciar la interfaz
        document.getElementById('setup-section').classList.remove('hidden');
        document.getElementById('exam-section').classList.add('hidden');
        document.getElementById('results-section').classList.add('hidden');

        // Reiniciar los botones de selección
        document.querySelectorAll('.select-btn').forEach(btn => {
            btn.classList.remove('selected');
            btn.textContent = 'Seleccionar';
        });
    }
}

// Inicializar el sistema cuando el DOM esté listo
let examSystem;
document.addEventListener('DOMContentLoaded', () => {
    examSystem = new ExamSystem();
});
</script>





</body>
</html>